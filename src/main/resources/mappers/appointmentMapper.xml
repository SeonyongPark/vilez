<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.vilez.appointment.model.mapper.AppointmentMapper">
    <resultMap id="appointment" type="appointmentDto">
        <result column="appointment_id" property="appointmentId"/>
        <result column="board_id" property="boardId"/>
        <result column="share_user_id" property="shareUserId"/>
        <result column="not_share_user_id" property="notShareUserId"/>
        <result column="appointment_start" property="appointmentStart"/>
        <result column="appointment_end" property="appointmentEnd"/>
    </resultMap>
    <resultMap id="room" type="roomDto">
        <result column="id" property="id"/>
        <result column="board_id" property="boardId"/>
        <result column="type" property="type"/>
        <result column="share_user_id" property="shareUserId"/>
        <result column="not_share_user_id" property="notShareUserId"/>
    </resultMap>



    <select id="getAppointmentList" parameterType="int" resultMap="appointment">
        SELECT appointment_id, board_id, share_user_id, not_share_user_id, appointment_start, appointment_end
        FROM appointment
        WHERE board_id = #{boardId};
    </select>

    <insert id="create" parameterType="appointmentDto">
        INSERT INTO appointment(board_id, share_user_id, not_share_user_id,
                                appointment_start, appointment_end)
        VALUES (#{boardId}, #{shareUserId}, #{notShareUserId}, #{appointmentStart}, #{appointmentEnd});
    </insert>

    <select id="getRoomListByUserId" parameterType="int" resultMap="room">
        SELECT * FROM room where share_user_id = #{shareUserId} or not_share_user_id = #{notShareUserId};
    </select>

    <insert id="creatRoom" parameterType="roomDto">
        <selectKey resultType="int" keyProperty="id" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into room (type,board_id,share_user_id,not_share_user_id)
        values (#{type},#{boardId}, #{shareUserId},#{notShareUserId});
    </insert>
</mapper>